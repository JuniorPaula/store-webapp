{{template "base" .}}

{{define "title"}}
Todas as vendas
{{end}}

{{define "content"}}
    <h2 class="mt-5">Todas as vendas</h2>

    <div class="card p-2">
        <table class="table table-striped table-light" id="sales-tables">
            <thead>
                <tr>
                    <th>Transação</th>
                    <th>Cliente</th>
                    <th>Produto</th>
                    <th>Valor</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>
{{end}}

{{define "js"}}
<script>
    let token = localStorage.getItem("token");
    let tbody = document.getElementById("sales-tables").getElementsByTagName("tbody")[0];

    const requestOptions = {
        method: 'POST',
        headers: {
            'Accept': 'application/json',
            'Content-type': 'application/json',
            'Authorization': 'Bearer ' + token
        },
    }

    fetch('{{.API}}'+ '/admin/all-sales', requestOptions)
        .then(response => response.json())
        .then(function(data) {
            console.log(data)

            data.forEach(function(i) {
                let newRow = tbody.insertRow()
                let newCell = newRow.insertCell()

                newCell.innerHTML = `<a href="/admin/sales/${i.id}">Pedido ${i.id}</a>`
                newCell = newRow.insertCell()

                let item = document.createTextNode(i.customer.first_name + " " + i.customer.last_name)
                newCell.appendChild(item)

                newCell = newRow.insertCell()
                item = document.createTextNode(i.widget.name)
                newCell.appendChild(item)

                newCell = newRow.insertCell()
                item = document.createTextNode(i.transaction.amount)
                newCell.appendChild(item)
            });
        })
</script>
{{end}}